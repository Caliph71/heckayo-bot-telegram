"use strict";var e=require("axios"),s=require("pluralize"),a=require("kitsu-core");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e),i=t(s);module.exports=class{constructor(e={}){!1===e.camelCaseTypes?this.camel=e=>e:this.camel=a.camel,"none"===e.resourceCase?this.resCase=e=>e:"snake"===e.resourceCase?this.resCase=a.snake:this.resCase=a.kebab,!1===e.pluralize?this.plural=e=>e:this.plural=i.default,this.headers=Object.assign({},e.headers,{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"}),this.axios=r.default.create(Object.assign({},{baseURL:e.baseURL||"https://kitsu.io/api/edge",timeout:e.timeout||3e4},e.axiosOptions)),this.fetch=this.get,this.update=this.patch,this.create=this.post,this.remove=this.delete,this.interceptors=this.axios.interceptors}async get(e,s={},t={}){try{const[r,i,l]=e.split("/");let c=this.plural(this.resCase(r));i&&(c+="/".concat(i)),l&&(c+="/".concat(this.resCase(l)));const{data:h}=await this.axios.get(c,{params:s,paramsSerializer:e=>a.query(e),headers:Object.assign(this.headers,t)});return a.deserialise(h)}catch(e){throw a.error(e)}}async patch(e,s,t={}){try{const[r,i]=a.splitModel(e,{resourceCase:this.resCase,pluralModel:this.plural}),l=a.serialise(r,s,"PATCH",{camelCaseTypes:this.camel,pluralTypes:this.plural}),c=null!=s&&s.id?"".concat(i,"/").concat(s.id):i,{data:h}=await this.axios.patch(c,l,{headers:Object.assign(this.headers,t)});return a.deserialise(h)}catch(e){throw a.error(e)}}async post(e,s,t={}){try{const[r,i]=a.splitModel(e,{resourceCase:this.resCase,pluralModel:this.plural}),{data:l}=await this.axios.post(i,a.serialise(r,s,"POST",{camelCaseTypes:this.camel,pluralTypes:this.plural}),{headers:Object.assign(this.headers,t)});return a.deserialise(l)}catch(e){throw a.error(e)}}async delete(e,s,t={}){try{const[r,i]=a.splitModel(e,{resourceCase:this.resCase,pluralModel:this.plural});let l,c;Array.isArray(s)?(l=i,c=s.map((e=>({id:e})))):(l="".concat(i,"/").concat(s),c={id:s});const{data:h}=await this.axios.delete(l,{data:a.serialise(r,c,"DELETE",{camelCaseTypes:this.camel,pluralTypes:this.plural}),headers:Object.assign(this.headers,t)});return h}catch(e){throw a.error(e)}}async self(e={},s={}){try{return(await this.get("users",Object.assign({filter:{self:!0}},e),s)).data[0]}catch(e){throw a.error(e)}}async request({body:e,method:s,params:t,type:r,url:i},l={}){try{var c;s=(null===(c=s)||void 0===c?void 0:c.toUpperCase())||"GET";const{data:h}=await this.axios.request({method:s,url:i,data:["GET","DELETE"].includes(s)?void 0:a.serialise(r,e,s,{camelCaseTypes:this.camel,pluralTypes:this.plural}),params:t,paramsSerializer:e=>a.query(e),headers:Object.assign(this.headers,l)});return a.deserialise(h)}catch(e){throw a.error(e)}}};
