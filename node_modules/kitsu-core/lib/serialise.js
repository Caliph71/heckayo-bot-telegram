"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./error.js");function r(t,r,e,n){const a=new Error("".concat(n," requires an ID for the ").concat(r," type"));if(void 0===r)throw new Error("".concat(n," requires a resource type"));if(t){if("POST"!==n&&e.length>0)for(const t of e)if(!t.id)throw a}else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error("".concat(n," requires an object or array body"));if("POST"!==n&&!e.id)throw a}}function e(t,r,e){r[e]={data:{}};for(const n of Object.keys(t[e].data)){const a=t[e].data[n];let o=r[e].data;n&&!["id","type"].includes(n)?o=i(a,n,o):o[n]=a}return r}function n(t,r,e){r[e]={data:[]};for(const n of t[e].data)r[e].data.push(n);return r}function a(t){let r={};for(const a in t){r=Array.isArray(t[a].data)?n(t,r,a):e(t,r,a)}return r}function o(t,r,e,n){return n.relationships||(n.relationships={}),t.type||(t.type=r),n.relationships[e]={data:Object.assign(t)},n.relationships=a(n.relationships),n}function s(t,r,e,n){return n.relationships||(n.relationships={}),n.relationships[e]={data:t.map((({id:t,type:e,...n})=>({id:t,type:e||r,attributes:Object.keys(n).length?n:void 0})))},n.relationships=a(n.relationships),n}function i(t,r,e){return e.attributes||(e.attributes={}),e.attributes[r]=t,e}function c(t){return Object.prototype.hasOwnProperty.call(t,"id")}function l(t,e,n,a){r(!1,t,e,n);let l={type:t=a.pluralTypes(a.camelCaseTypes(t))};null!=e&&e.id&&(l.id=String(e.id));for(const t in e){const r=e[t],n=a.pluralTypes(a.camelCaseTypes(t));null!==r&&(null==r?void 0:r.constructor)===Object&&c(r)?l=o(r,n,t,l):null!==r&&Array.isArray(r)&&r.length>0&&c(r[0])?l=s(r,n,t,l):"id"!==t&&"type"!==t&&(l=i(r,t,l))}return{data:l}}exports.serialise=function(e,n={},a="POST",o={}){try{return o.camelCaseTypes||(o.camelCaseTypes=t=>t),o.pluralTypes||(o.pluralTypes=t=>t),null===n||Array.isArray(n)&&0===n.length?{data:n}:Array.isArray(n)&&(null==n?void 0:n.length)>0?function(t,e,n,a){r(!0,t,e,n);const o=[];for(const r of e)o.push(l(t,r,n,a).data);return{data:o}}(e,n,a,o):l(e,n,a,o)}catch(r){throw t.error(r)}};
